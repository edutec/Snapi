<blocks app="Snap! 4.0, http://snap.berkeley.edu" version="1"><block-definition s="crida a iCity %&apos;crida&apos; amb paràmetres %&apos;params&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%txt"></input><input type="%mult%n"></input></inputs><script><block s="doReport"><block s="apiCall"><l><option>GET</option></l><l><option>https://</option></l><block s="reportJoinWords"><list><l>icity-239306f14390.my.apitools.com/api/</l><block var="crida"/></list></block><block var="params"/></block></block></script></block-definition><block-definition s="totes les infraestructures" type="reporter" category="api"><header></header><code></code><inputs></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><l>infrastructures</l><list></list></custom-block></block></script></block-definition><block-definition s="totes les ciutats" type="reporter" category="api"><header></header><code></code><inputs></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><l>cities</l><list></list></custom-block></block></script></block-definition><block-definition s="tots els dispositius" type="reporter" category="api"><header></header><code></code><inputs></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><l>devices</l><list><l></l></list></custom-block></block></script></block-definition><block-definition s="infraestructura amb id %&apos;id&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%n"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><block s="reportJoinWords"><list><l>infrastructures/</l><block var="id"/></list></block><list><l></l></list></custom-block></block></script></block-definition><block-definition s="ciutat amb id %&apos;id&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%n"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><block s="reportJoinWords"><list><l>cities/</l><block var="id"/></list></block><list></list></custom-block></block></script></block-definition><block-definition s="dispositiu amb id %&apos;id&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%n"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><block s="reportJoinWords"><list><l>devices/</l><block var="id"/></list></block><list></list></custom-block></block></script></block-definition><block-definition s="dispositius de la infraestructura amb id %&apos;id&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%n"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><block s="reportJoinWords"><list><l>infrastructures/</l><block var="id"/><l>/devices</l></list></block><list><l></l></list></custom-block></block></script></block-definition><block-definition s="dispositius de la ciutat amb id %&apos;id&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%n"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><block s="reportJoinWords"><list><l>cities/</l><block var="id"/><l>/devices</l></list></block><list></list></custom-block></block></script></block-definition><block-definition s="infraestructures de la ciutat amb id %&apos;id&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%n"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><l>infrastructures</l><list><block s="newAssociation"><l>cityID</l><block var="id"/></block></list></custom-block></block></script></block-definition><block-definition s="dispositiu amb nom %&apos;nom&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%txt"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><l>devices</l><list><block s="newAssociation"><l>deviceName</l><block var="nom"/></block></list></custom-block></block></script></block-definition><block-definition s="dispositius amb propietat %&apos;prop&apos; de ciutat amb id %&apos;ciutat&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%s"></input><input type="%n"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><l>devices</l><list><block s="newAssociation"><l>propertyName</l><block var="prop"/></block><block s="newAssociation"><l>cityID</l><block var="ciutat"/></block></list></custom-block></block></script></block-definition><block-definition s="tipus de propietats de dispositius al JSON %&apos;jsonString&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%txt"></input></inputs><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l>jsonString</l></list><l>var result = [],&#xD;    json = JSON.parse(jsonString);&#xD;&#xD;json.forEach(function(eachDevice) {&#xD;    eachDevice.properties.forEach(function(eachProp){&#xD;        if (result.indexOf(eachProp) == -1) {&#xD;            result.push(eachProp)&#xD;        } &#xD;    })&#xD;});&#xD;return JSON.stringify(result)</l></block><list><block var="jsonString"/></list></block></block></script><scripts><script x="539" y="16"><block s="doDeclareVariables"><list><l>i</l><l>result</l></list></block><block s="doSetVar"><l>i</l><l>1</l></block><block s="doSetVar"><l>result</l><block s="reportNewList"><list></list></block></block><block s="doWarp"><script><block s="doRepeat"><block s="reportListLength"><block var="llista"/></block><script><block s="doDeclareVariables"><list><l>subindex</l></list></block><block s="doSetVar"><l>subindex</l><l>1</l></block><block s="doRepeat"><block s="reportListLength"><block s="valueAt"><l>properties</l><block s="reportListItem"><block var="subindex"/><block var="llista"/></block></block></block><script><block s="doIf"><block s="reportNot"><block s="reportListContainsItem"><block var="result"/><block s="reportListItem"><block var="subindex"/><block s="valueAt"><l>properties</l><block s="reportListItem"><block var="i"/><block var="llista"/></block></block></block></block></block><script><block s="doAddToList"><block s="reportListItem"><block var="subindex"/><block s="valueAt"><l>properties</l><block s="reportListItem"><block var="i"/><block var="llista"/></block></block></block><block var="result"/></block></script></block><block s="doChangeVar"><l>subindex</l><l>1</l></block></script></block><block s="doChangeVar"><l>i</l><l>1</l></block></script></block></script></block><block s="doReport"><block var="result"/></block></script></scripts></block-definition><block-definition s="dispositius al JSON %&apos;jsonString&apos; a %&apos;distancia&apos; km de ( %&apos;lat&apos; , %&apos;long&apos; )" type="reporter" category="api"><header></header><code></code><inputs><input type="%txt"></input><input type="%n"></input><input type="%n"></input><input type="%n"></input></inputs><script><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l>jsonString</l><l>distance</l><l>lat</l><l>long</l></list><l>var result = [],&#xD;    json = JSON.parse(jsonString),&#xD;    factor = 40000/360;&#xD;&#xD;json.forEach(function(eachDevice) {&#xD;    if ((Math.abs(eachDevice.latitude - lat) * factor &lt; distance) &#xD;       &amp;&amp; (Math.abs(eachDevice.longitude - long) * factor) * Math.sin(eachDevice.latitude) &lt; distance) {&#xD;        result.push(eachDevice)&#xD;    } &#xD;});&#xD;&#xD;return JSON.stringify(result)</l></block><list><block var="jsonString"/><block var="distancia"/><block var="lat"/><block var="long"/></list></block></block></script></block-definition><block-definition s="últimes %&apos;nombre&apos; lectures de %&apos;propietat&apos; del dispositiu amb id %&apos;id&apos;" type="reporter" category="api"><header></header><code></code><inputs><input type="%n"></input><input type="%txt"></input><input type="%n"></input></inputs><script><block s="doReport"><custom-block s="crida a iCity %txt amb paràmetres %mult%n"><l>observations/last</l><list><block s="newAssociation"><l>n</l><block var="nombre"/></block><block s="newAssociation"><l>property</l><block var="propietat"/></block><block s="newAssociation"><l>id</l><block var="id"/></block></list></custom-block></block></script></block-definition></blocks>